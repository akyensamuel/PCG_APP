{% extends 'base.html' %}
{% load widget_tweaks %}
{% block title %}Sign up • PCG - A.N.T{% endblock %}
{% block content %}
<div class="max-w-xl">
  <h1 class="text-2xl font-bold mb-4">Create an account</h1>
  <form method="post" enctype="multipart/form-data">{% csrf_token %}
    <div class="space-y-4">
      {{ form.non_field_errors }}
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-medium text-gray-900 dark:text-white mb-2">First name</label>
          {{ form.first_name|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
          {{ form.first_name.errors }}
        </div>
        <div>
          <label class="block font-medium text-gray-900 dark:text-white mb-2">Last name</label>
          {{ form.last_name|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
          {{ form.last_name.errors }}
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-medium text-gray-900 dark:text-white mb-2">Username</label>
          {{ form.username|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
          {{ form.username.errors }}
        </div>
        <div>
          <label class="block font-medium text-gray-900 dark:text-white mb-2">Age</label>
          {{ form.age|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
          {{ form.age.errors }}
        </div>
      </div>

      <div>
        <label class="block font-medium text-gray-900 dark:text-white mb-2">Email</label>
        {{ form.email|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
        {{ form.email.errors }}
      </div>

      <div>
        <label class="block font-medium text-gray-900 dark:text-white mb-2">Phone</label>
        {{ form.phone|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
        {{ form.phone.errors }}
      </div>

      <div>
        <label class="block font-medium text-gray-900 dark:text-white mb-2">Date of Birth</label>
        {{ form.date_of_birth|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
        {{ form.date_of_birth.errors }}
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-medium text-gray-900 dark:text-white mb-2">Password</label>
          {{ form.password1|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
          {{ form.password1.errors }}
        </div>
        <div>
          <label class="block font-medium text-gray-900 dark:text-white mb-2">Confirm Password</label>
          {{ form.password2|add_class:'w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }}
          {{ form.password2.errors }}
        </div>
      </div>

      <div>
        <label class="block font-medium text-gray-900 dark:text-white mb-2">Profile Picture (optional)</label>
        <div class="border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700">
          {{ form.profile_picture }}
        </div>
        {{ form.profile_picture.errors }}
      </div>
    </div>

    <button class="mt-6 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">Create Account</button>
    <p class="text-sm mt-2 text-gray-600 dark:text-gray-400">Already have an account? <a href="{% url 'login' %}" class="text-blue-600 dark:text-blue-400 hover:underline">Sign in</a></p>
  </form>
</div>
{% endblock %}

      <!-- Confirm password -->
      <div>
  <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="{{ form.password2.id_for_label }}">Confirm password</label>
        {% if form.password2.errors %}
          {{ form.password2|add_class:'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-red-500 focus:border-red-500 border-red-500'|attr:'required:required'|attr:'aria-invalid:true' }}
          <p class="mt-1 text-sm text-red-600">{{ form.password2.errors.0 }}</p>
        {% else %}
          {{ form.password2|add_class:'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white'|attr:'required:required' }}
        {% endif %}
      </div>

      <!-- Date of birth -->
      <div>
  <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="{{ form.date_of_birth.id_for_label }}">Date of birth</label>
        {% if form.date_of_birth.errors %}
          {{ form.date_of_birth|add_class:'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-red-500 focus:border-red-500 border-red-500'|attr:'required:required'|attr:'aria-invalid:true' }}
          <p class="mt-1 text-sm text-red-600">{{ form.date_of_birth.errors.0 }}</p>
        {% else %}
          {{ form.date_of_birth|add_class:'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white'|attr:'required:required' }}
        {% endif %}
      </div>

      <!-- Avatar (optional) -->
      <div>
  <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="{{ form.avatar.id_for_label }}">Profile Image (optional)</label>
        {% if form.avatar.errors %}
          {{ form.avatar|add_class:'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-red-500 focus:border-red-500 border-red-500'|attr:'aria-invalid:true' }}
          <p class="mt-1 text-sm text-red-600">{{ form.avatar.errors.0 }}</p>
        {% else %}
          {{ form.avatar|add_class:'bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white' }}
        {% endif %}
      </div>

    <!-- Groups (Select2-ready) -->
      <div class="md:col-span-2">
  <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="{{ form.groups.id_for_label }}">Groups you'd like to join (applications)</label>
        {% if form.groups.errors %}
      {{ form.groups|add_class:'js-groups-select bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white focus:ring-red-500 focus:border-red-500 border-red-500'|attr:'required:required'|attr:'aria-invalid:true'|attr:'data-placeholder:Select groups'|attr:'data-url:/groups/api/groups/' }}
          <p class="mt-1 text-sm text-red-600">{{ form.groups.errors.0 }}</p>
        {% else %}
      {{ form.groups|add_class:'js-groups-select bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white'|attr:'required:required'|attr:'data-placeholder:Select groups'|attr:'data-url:/groups/api/groups/' }}
        {% endif %}
  <p class="text-xs text-gray-500 mt-1">We’ll send applications to the selected groups. Leaders/Admins can approve them. Hold Ctrl (Windows) or Cmd (Mac) to select multiple.</p>
      </div>
    </div>
  <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Sign up</button>
  </form>
</div>
{% block scripts %}
  {{ block.super }}
  <!-- Select2 assets (optional CDN; replace with local/static if you prefer) -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    /* Dark-mode friendly inputs */
    html.dark input[type="text"],
    html.dark input[type="password"],
    html.dark input[type="email"],
    html.dark input[type="number"],
    html.dark input[type="date"],
    html.dark select,
    html.dark textarea {
      background-color: rgb(51 65 85); /* slate-700 */
      color: #fff;
    }
    html.dark input::placeholder,
    html.dark textarea::placeholder {
      color: rgba(255,255,255,0.6);
    }
    /* Select2 theming to match dark */
    html.dark .select2-container--default .select2-selection--multiple,
    html.dark .select2-container--default .select2-selection--single {
      background-color: rgb(51 65 85);
      border-color: rgb(71 85 105);
      color: #fff;
    }
    html.dark .select2-dropdown { background-color: rgb(30 41 59); color: #fff; }
    html.dark .select2-results__option { color: #fff; }
    html.dark .select2-search__field { background-color: rgb(51 65 85); color: #fff; }
    html.dark .select2-container--default .select2-selection--multiple .select2-selection__choice {
      background-color: rgb(15 23 42); border-color: rgb(71 85 105); color: #fff;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const $ = window.jQuery || window.$;
      const selects = document.querySelectorAll('.js-groups-select');
      if (selects.length && $ && $.fn && $.fn.select2) {
        selects.forEach(function(el){
          const placeholder = el.getAttribute('data-placeholder') || 'Select groups';
          const url = el.getAttribute('data-url') || '/groups/api/groups/';
          $(el).select2({
            placeholder: placeholder,
            width: '100%',
            ajax: {
              url: url,
              dataType: 'json',
              delay: 250,
              data: function(params) {
                return { q: params.term || '', page: params.page || 1 };
              },
              processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                  results: data.results,
                  pagination: { more: data.pagination && data.pagination.more }
                };
              },
              cache: true
            },
            minimumInputLength: 0,
            templateResult: function (data, container) {
              if (data.loading) return data.text;
              const selected = $(el).val() || [];
              const isChecked = selected.includes(String(data.id));
              const $markup = $(
                `<div class="flex items-center gap-2">
                   <input type="checkbox" ${isChecked ? 'checked' : ''} />
                   <span>${data.text}</span>
                 </div>`
              );
              return $markup;
            }
          });
        });
      }
    });
  </script>
{% endblock %}